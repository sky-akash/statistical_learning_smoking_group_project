#Load Dataset
attach(Smoking_Training_Data)

#Create Dataframe
df = Smoking_Training_Data

head(df)

str(df)

colnames(df)

df <- na.omit(df)
str(df)

summary(df)

#Renaming Colnames for simplicity
colnames(df)[colnames(df) == "height(cm)"] <- "height_cm"
colnames(df)[colnames(df) == "weight(kg)"] <- "weight_kg"
colnames(df)[colnames(df) == "waist(cm)"] <- "waist_cm"
colnames(df)[colnames(df) == "eyesight(left)"] <- "eyesight_left"
colnames(df)[colnames(df) == "eyesight(right)"] <- "eyesight_right"
colnames(df)[colnames(df) == "hearing(left)"] <- "hearing_left"
colnames(df)[colnames(df) == "hearing(right)"] <- "hearing_right"
colnames(df)[colnames(df) == "fasting blood sugar"] <- "fasting_blood_sugar"
colnames(df)[colnames(df) == "Urine protein"] <- "urine_protein"
colnames(df)[colnames(df) == "serum creatinine"] <- "serum_creatinine"
colnames(df)[colnames(df) == "dental caries"] <- "dental_caries"

str(df)

#Adding Extra Columns to dataset for Derived Variables 
# Var1 is WHtR (Waist to Height Ratio) = waist (cm)/ height (cm)
# Var2 is as_lt i.e. AST / ALT ratio
# Var3 is BMI, Body Mass Index = Weight (kg)/ height^2 (m)


df$WHtR <- df$waist_cm/df$height_cm
df$as_lt <- df$AST/df$ALT
df$BMI <- df$weight_kg / (df$height_cm/100)

str(df)

df$dental_caries <- factor(df$dental_caries)
df$hearing_left <- factor(df$hearing_left)
df$hearing_right <- factor(df$hearing_right)

str(df)

##################################################

# Splitting Dataset for Training, Validation and Test
set.seed(1)

#To split the dataset randomly into the three categories, let's generate random indices to split the dataset
indices <- sample(1:nrow(df), size=nrow(df), replace=FALSE) #Random Sampling the whole dataset without repetition

# Define proportions for splitting
train_prop <- 0.7  # 70% for training
val_prop <- 0.15   # 15% for validation
test_prop <- 0.15  # 15% for testing

# Calculate the number of samples for each set
train_size <- round(train_prop * nrow(df))
val_size <- round(val_prop * nrow(df))
test_size <- nrow(df) - train_size - val_size


# Split the data
train_data <- df[indices[1:train_size], ]
val_data <- df[indices[(train_size + 1):(train_size + val_size)], ]
test_data <- df[indices[(train_size + val_size + 1):nrow(df)], ]

# Let's print the dimensions of the split datasets
dim(train_data)
dim(val_data)
dim(test_data)



# Training Dataset
library(ggplot2)

# Generate box plots for each variable
par(mfrow = c(6, 6))  # Set up a multi-panel plot
for (i in 1:26) {
  boxplot(train_data[, i], main = colnames(df)[i], col = "skyblue", border = "black", horizontal = TRUE)
}

summary(train_data)
str(train_data)

# hist(train_data$height_cm, main="Histogram of Height values", xlab="Height values")

#Histogram for Each Column in dataset
# Create a layout for the plots
par(mfrow = c(5, 6))

# Iterate over each column in the dataframe
for (col in names(train_data)) {
  if (is.numeric(train_data[[col]])) {
    # Plot histogram for numeric columns
    hist(train_data[[col]], main = paste("Histogram of", col),
         xlab = col, ylab = "Frequency")
  } else {
    # Plot bar plot for factor columns
    barplot(table(train_data[[col]]), main = paste("Bar Plot of", col),
            xlab = col, ylab = "Frequency")
  }
}

# Logistic Regression

#install.packages("glmnet")

library(glmnet)

#Pair Plots of Training Data

#pairs(train_data)
# Fit logistic regression model
model <- glm(smoking ~ . -height_cm -weight_kg -waist_cm -AST -ALT, data = train_data, family = binomial)

# Summary of the model
summary(model)


# Residuals
residuals <- residuals(model)
#residuals

# Deviance
deviance <- deviance(model)
#deviance

# Confusion Matrix
predicted <- ifelse(predict(model, newdata = train_data, type = "response") > 0.5, 1, 0)
confusion_matrix <- table(predicted, train_data$smoking)
print(confusion_matrix)


# ROC Curve and AUC
library(pROC)
roc_curve <- roc(train_data$smoking, predict(model, newdata = train_data, type = "response"))
plot(roc_curve, main = "ROC Curve")
auc(roc_curve)

#Install Resource-Selection Package
#install.packages("ResourceSelection")
library(ResourceSelection)

# Hosmer-Lemeshow Test
hoslem.test(train_data$smoking, fitted(model))

str(train_data)

# Apply the logistic regression model to the validation dataset to obtain predictions
validation_pred <- predict(model, newdata = val_data, type = "response")

# Evaluate the performance of the model on the validation dataset
# You can use metrics such as accuracy, AUC, precision, recall, etc.
# For example, if you have true labels for the validation dataset, you can compute accuracy:
val_labels <- val_data$smoking  # Assuming 'smoking' is the outcome variable
accuracy <- mean(ifelse(val_labels == 1, validation_pred >= 0.5, validation_pred < 0.5))

accuracy

















